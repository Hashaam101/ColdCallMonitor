// Cold Calls Dashboard - Database Schema
// This is the master schema definition for all collections
// Note: Appwrite uses $id, $createdAt, $updatedAt as system fields

Table companies {
  id varchar [pk, note: 'Appwrite: $id']
  owner_name varchar
  company_name varchar [not null]
  company_location varchar
  google_maps_link varchar

  // System fields
  createdAt datetime [default: `now()`, note: 'Appwrite: $createdAt']
  updatedAt datetime [default: `now()`, note: 'Appwrite: $updatedAt']
}

Table transcripts {
  id varchar [pk, note: 'Appwrite: $id']
  call_id varchar [ref: - ColdCalls.id, not null, note: 'One-to-one with ColdCall']
  transcript text [not null]

  // System fields (createdAt kept for auditing, no updatedAt needed)
  createdAt datetime [default: `now()`, note: 'Appwrite: $createdAt']
}

Table ColdCalls {
  id varchar [pk, unique, not null, note: 'Appwrite: $id']
  
  // Company relationship (replaces inline company fields)
  company_id varchar [ref: > companies.id, note: 'nullable for calls without company']
  
  caller_name varchar
  recipients varchar
  call_outcome varchar [note: 'Values: Interested, Not Interested, Callback, No Answer, Wrong Number, Other']
  interest_level int [note: 'Range: 1-10']
  objections text [note: 'JSON array stored as string']
  pain_points text [note: 'JSON array stored as string']
  follow_up_actions text [note: 'JSON array stored as string']
  call_summary text
  call_duration_estimate varchar

  // AI model metadata
  model_used varchar

  // Team collaboration
  claimed_by varchar [ref: > team_members.id, note: 'nullable = unclaimed']

  // System fields (auto-managed by Appwrite)
  createdAt datetime [default: `now()`, note: 'Appwrite: $createdAt']
  updatedAt datetime [default: `now()`, note: 'Appwrite: $updatedAt']
}

Table team_members {
  id varchar [pk, note: 'Appwrite: $id - same as auth user ID']
  name varchar [not null]
  email varchar [not null]
  role varchar [not null, note: 'Values: admin, member']

  // System fields
  createdAt datetime [default: `now()`, note: 'Appwrite: $createdAt']
  updatedAt datetime [default: `now()`, note: 'Appwrite: $updatedAt']
}

Table alerts {
  id varchar [pk, note: 'Appwrite: $id']
  created_by varchar [not null, ref: > team_members.id]
  target_user varchar [not null, ref: > team_members.id]
  entity_type varchar [not null, note: 'Values: cold_call (extensible)']
  entity_id varchar [not null, note: 'Reference to entity document ID']
  entity_label varchar [note: 'Display name, e.g., "TechCorp - John"']
  alert_time datetime [note: 'null = instant alert, otherwise scheduled']
  message text
  is_dismissed boolean [default: false]

  // System fields
  createdAt datetime [default: `now()`, note: 'Appwrite: $createdAt']
  updatedAt datetime [default: `now()`, note: 'Appwrite: $updatedAt']
}

// Relationships
// Ref: ColdCalls.company_id > companies.id
// Ref: transcripts.call_id - ColdCalls.id (one-to-one)
// Ref: ColdCalls.claimed_by > team_members.id
// Ref: alerts.created_by > team_members.id
// Ref: alerts.target_user > team_members.id

